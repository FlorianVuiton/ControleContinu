{% extends "layouts/base.html" %}

{% block title %} Controle Continu {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
            
          <div class="row">
            <div class="tim-typo col-lg-8 col-md-8">
              <h1>Controle Continu de {{ client.name_client }} </h1>
            </div>
            <div class="col-lg-4 col-md-4">
              <form action="{% url 'show_controle_continu' %}" method="POST">
                {%csrf_token %}
                <div class="pull-right">
                  <div class="row">
                    <button type="submit" class="btn btn-default" name="download_file_delta">
                      <i class="material-icons">file_download</i> Liste des delta
                    </button>
                  </div>
                  <div class="row">
                    <button type="submit" class="btn btn-default" name="download_file_subdomain">
                      <i class="material-icons">file_download</i> Liste des sous-domaines
                  </button>
                  </div>
                  <div class="row">
                    <button type="submit" class="btn btn-default" name="download_file_port">
                      <i class="material-icons">file_download</i> Liste des ports ouvert
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8 offset-md-2">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">Recherche de sous-domaines</h4>
                  <!--<p class="card-category">Complete your profile</p>-->
                </div>
                <div class="card-body">
                  <form action="{% url 'show_controle_continu' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                      <div class="col-md-6 ">
                        <div class="form-group form-file-upload form-file-multiple">
                          <input type="file" multiple="" class="inputFileHidden" name="file_domain">
                          <div class="input-group">
                              <input type="text" class="form-control inputFileVisible" placeholder="Liste des domaines">
                              <span class="input-group-btn">
                                  <button type="button" class="btn btn-fab btn-round btn-primary">
                                    <i class="material-icons">attach_file</i>
                                  </button>
                              </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <button type="submit" class="btn btn-success pull-right" name="sublist3r">Lancer Sublist3r</button>
                    <div class="clearfix"></div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
          <div class="col-lg-6 col-md-12">
            <div class="card">
              <div class="card-header card-header-tabs card-header-info">
                <div class="nav-tabs-navigation">
                  <div class="nav-tabs-wrapper">
                    <span class="nav-tabs-title">Listes :</span>
                    <ul class="nav nav-tabs" data-tabs="tabs">
                      <li class="nav-item">
                        <a class="nav-link active" href="#delta" data-toggle="tab">
                          <i class="material-icons">change_history</i> Liste de Delta
                          <div class="ripple-container"></div>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#base" data-toggle="tab">
                          <i class="material-icons">playlist_add_check</i> Liste de référence
                          <div class="ripple-container"></div>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#ban" data-toggle="tab">
                          <i class="material-icons">cancel</i> Liste d'exclusion
                          <div class="ripple-container"></div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="tab-content">
                  <div class="tab-pane active" id="delta">
                    <table class="table">
                      <tbody>
                        {% for delta in list_delta %}
                        <tr>
                          <form action="{% url 'show_controle_continu' %}" method="POST">
                            {%csrf_token %}
                            <td>{{ delta.name_asset }}</td>
                            <td class="td-actions text-right">
                              <button type="submit" rel="tooltip" title="Déplacer dans la liste de référence" name="to_list_base" value="{{ delta }}" onclick="md.showNotification_list('bottom','right', 'success', '{{ delta.name_asset }} déplacé dans la liste de référence')" class="btn btn-success btn-link btn-sm">
                                <i class="material-icons">check</i>
                              </button>
                              <button type="submit" rel="tooltip" title="Déplacer dans la liste d'exclusion" name="to_list_ban" value="{{ delta }}" onclick="md.showNotification_list('bottom','right', 'danger', '{{ delta.name_asset }} déplacé dans la liste d\'exclusion)" class="btn btn-danger btn-link btn-sm">
                                <i class="material-icons">close</i>
                              </button>
                            </td>
                          </form>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="tab-pane" id="base">
                    <table class="table">
                      <tbody>
                        {% for base in list_base %}
                        <tr>
                          <form action="{% url 'show_controle_continu' %}" method="POST">
                            {%csrf_token %}
                            <td>{{ base.name_asset }}</td>
                            <td class="td-actions text-right">
                              <button type="submit" rel="tooltip" title="Déplacer dans la liste d'exclusion" name="to_list_ban" value="{{ base }}" onclick="md.showNotification_list('bottom','right', 'danger', '{{ base.name_asset }} déplacé dans la liste de référence')" class="btn btn-danger btn-link btn-sm">
                                <i class="material-icons">east</i>
                              </button>
                            </td>
                          </form>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                      <form action="{% url 'show_controle_continu' %}" method="POST">
                        {%csrf_token %}  
                        <button type="submit" title="Lancer un scan" name="dig_nmap" onclick="md.showNotification_list('bottom','right', 'success', 'Scan lancé')" class="btn btn-success pull-right">Lancer un Dig + Nmap depuis la liste de référence
                        </button>
                      </form>
                  </div>
                  <div class="tab-pane" id="ban">
                    <table class="table">
                      <tbody>
                        {% for ban in list_ban %}
                        <tr>
                          <form action="{% url 'show_controle_continu' %}" method="POST">
                            {%csrf_token %}  
                            <td>{{ ban.name_asset }}</td>
                            <td class="td-actions text-right">
                              <button type="submit" rel="tooltip" title="Déplacer dans la liste de référence" name="to_list_base" value="{{ ban }}" onclick="md.showNotification_list('bottom','right', 'success', '{{ ban.name_asset }} déplacé dans la liste de référence')" class="btn btn-success btn-link btn-sm">
                                <i class="material-icons">west</i>
                              </button>
                            </td>
                          </form>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
            <div class="col-lg-4 col-md-12">
                <div class="card">
                  <div class="card-header card-header-danger">
                    <h4 class="card-title">Liste des ports ouverts</h4>
                  </div>
                  <div class="card-body table-responsive">
                    <table class="table table-hover">
                      <thead class="text-danger">
                        <th>Numéro de port</th>
                        <th>Protocole</th>
                      </thead>
                      <tbody>
                        {% for port in list_port %}
                        <tr>
                          <td>{{ port.num }}</td>
                          <td>{{ port.protocol }}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-12">
                <div class="card">
                  <div class="card-header card-header-warning">
                    <h4 class="card-title">Historique des scans</h4>
                  </div>
                  <div class="card-body table-responsive">
                    <table class="table table-hover">
                      <thead class="text-warning">
                        <th>ID</th>
                        <th>Date</th>
                      </thead>
                      <tbody>
                        {% for scan in scan_history %}
                        <tr>
                          <td>{{ scan.id_scan }}</td>
                          <td>{{ scan.date }}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
          </div>
    
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}
